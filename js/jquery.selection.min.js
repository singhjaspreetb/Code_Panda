/*!
 * jQuery.selection - jQuery Plugin
 *
 * Copyright (c) 2010-2014 IWASAKI Koji (@madapaja).
 * http://blog.madapaja.net/
 * Under The MIT License
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(c,e,d){var a=function(j){var i={text:"",start:0,end:0};if(!j.value){return i}try{if(e.getSelection){i.start=j.selectionStart;i.end=j.selectionEnd;i.text=j.value.slice(i.start,i.end)}else{if(d.selection){j.focus();var g=d.selection.createRange(),f=d.body.createTextRange(),h;i.text=g.text;try{f.moveToElementText(j);f.setEndPoint("StartToStart",g)}catch(k){f=j.createTextRange();f.setEndPoint("StartToStart",g)}i.start=j.value.length-f.text.length;i.end=i.start+g.text.length}}}catch(k){}return i};var b={getPos:function(g){var f=a(g);return{start:f.start,end:f.end}},setPos:function(g,h,j){j=this._caretMode(j);if(j=="start"){h.end=h.start}else{if(j=="end"){h.start=h.end}}g.focus();try{if(g.createTextRange){var f=g.createTextRange();if(e.navigator.userAgent.toLowerCase().indexOf("msie")>=0){h.start=g.value.substr(0,h.start).replace(/\r/g,"").length;h.end=g.value.substr(0,h.end).replace(/\r/g,"").length}f.collapse(true);f.moveStart("character",h.start);f.moveEnd("character",h.end-h.start);f.select()}else{if(g.setSelectionRange){g.setSelectionRange(h.start,h.end)}}}catch(i){}},getText:function(f){return a(f).text},_caretMode:function(f){f=f||"keep";if(f===false){f="end"}switch(f){case"keep":case"start":case"end":break;default:f="keep"}return f},replace:function(h,j,i){var g=a(h),l=h.value,k=c(h).scrollTop(),f={start:g.start,end:g.start+j.length};h.value=l.substr(0,g.start)+j+l.substr(g.end);c(h).scrollTop(k);this.setPos(h,f,i)},insertBefore:function(h,j,i){var g=a(h),l=h.value,k=c(h).scrollTop(),f={start:g.start+j.length,end:g.end+j.length};h.value=l.substr(0,g.start)+j+l.substr(g.start);c(h).scrollTop(k);this.setPos(h,f,i)},insertAfter:function(h,j,i){var g=a(h),l=h.value,k=c(h).scrollTop(),f={start:g.start,end:g.end};h.value=l.substr(0,g.end)+j+l.substr(g.end);c(h).scrollTop(k);this.setPos(h,f,i)}};c.extend({selection:function(j){var g=((j||"text").toLowerCase()=="text");try{if(e.getSelection){if(g){return e.getSelection().toString()}else{var h=e.getSelection(),f;if(h.getRangeAt){f=h.getRangeAt(0)}else{f=d.createRange();f.setStart(h.anchorNode,h.anchorOffset);f.setEnd(h.focusNode,h.focusOffset)}return c("<div></div>").append(f.cloneContents()).html()}}else{if(d.selection){if(g){return d.selection.createRange().text}else{return d.selection.createRange().htmlText}}}}catch(i){}return""}});c.fn.extend({selection:function(g,f){f=f||{};switch(g){case"getPos":return b.getPos(this[0]);case"setPos":return this.each(function(){b.setPos(this,f)});case"replace":return this.each(function(){b.replace(this,f.text,f.caret)});case"insert":return this.each(function(){if(f.mode=="before"){b.insertBefore(this,f.text,f.caret)}else{b.insertAfter(this,f.text,f.caret)}});case"get":default:return b.getText(this[0])}return this}})})(jQuery,window,window.document);